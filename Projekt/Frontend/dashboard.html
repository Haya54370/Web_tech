<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Dashboard - Booking System</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">

<style>
body{
  font-family:'Poppins',sans-serif;
  background:#f6f4fb;
}

/* NAVBAR */
.navbar{
  background:white;
  box-shadow:0 8px 25px rgba(0,0,0,.07);
}

/* HEADER */
.header{
  background:linear-gradient(135deg,#C74B9F,#8241C2);
  color:white;
  padding:70px 0;
  text-align:center;
  border-bottom-left-radius:35px;
  border-bottom-right-radius:35px;
  box-shadow:0 30px 80px rgba(0,0,0,.15);
}

/* INFO CARD */
.info-box{
  background:white;
  border-radius:20px;
  padding:22px;
  text-align:center;
  box-shadow:0 15px 50px rgba(0,0,0,.08);
  font-weight:600;
}

/* TABLE CARD */
.table-card{
  border-radius:20px;
  box-shadow:0 25px 80px rgba(0,0,0,.09);
  overflow:hidden;
}

/* BUTTON MAIN */
.btn-main{
  background:#8241C2;
  color:white;
  border-radius:12px;
  font-weight:600;
  border:none;
}

.btn-main:hover{
  background:#6f33ac;
}

/* REVEAL ANIMATION */
.reveal{
  opacity:0;
  transform:translateY(20px);
  transition:.6s;
}

.reveal.active{
  opacity:1;
  transform:none;
}

/* FOOTER */
footer{
  text-align:center;
  color:#777;
  margin-top:50px;
  padding:25px;
}
</style>
</head>

<body>

<!-- NAVBAR -->
<nav class="navbar fixed-top">
  <div class="container">
    <a class="navbar-brand fw-bold" href="index.html">Booking System</a>

    <div class="d-flex gap-2">
      <a href="about.html" class="btn btn-outline-secondary">About</a>
      <a href="faq.html" class="btn btn-outline-secondary">FAQ</a>
      <a href="contact.html" class="btn btn-outline-secondary">Contact</a>

      <a href="booking.html" class="btn btn-main">New Booking</a>

      <button class="btn btn-outline-danger" onclick="logout()">Logout</button>
    </div>
  </div>
</nav>

<!-- HEADER -->
<section class="header mt-5 reveal">
  <div class="container">
    <h2 class="fw-bold">My Bookings</h2>
    <p>Your scheduled appointments — simple & secure.</p>
  </div>
</section>

<div class="container mt-4" style="max-width:1000px;">

  <div id="status" class="alert alert-info reveal">Loading bookings...</div>

  <div class="row g-3 mb-4 text-center">
    <div class="col-md-4 reveal">
      <div class="info-box" id="countBox">0 Appointments</div>
    </div>
    <div class="col-md-4 reveal">
      <div class="info-box">24/7 Access</div>
    </div>
    <div class="col-md-4 reveal">
      <div class="info-box">Secure & Private</div>
    </div>
  </div>

  <div class="table-card bg-white reveal">
    <div class="p-3 d-flex justify-content-between">
      <h5 class="m-0 fw-bold">Your Appointments</h5>
      <button class="btn btn-outline-secondary" onclick="loadBookings()">Refresh</button>
    </div>

    <div class="table-responsive">
      <table class="table table-striped m-0 align-middle">
        <thead class="table-light">
          <tr>
            <th>Date</th>
            <th>Time</th>
            <th>Service</th>
            <th style="width:130px;">Action</th>
          </tr>
        </thead>
        <tbody id="tbody"></tbody>
      </table>
    </div>
  </div>

</div>

<footer>
  © 2025 Booking System — HAWK Project
</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script src="auth.js"></script>
<script>
requireLogin();

const API_BASE = "https://web-tech-5s0d.onrender.com";

function logout(){
  localStorage.clear();
  window.location.href="index.html";
}

function setStatus(type,text){
  const el=document.getElementById("status");
  el.className=`alert alert-${type}`;
  el.innerText=text;
}

async function loadBookings(){

  const userId=localStorage.getItem("userId");
  const tbody=document.getElementById("tbody");
  const countBox=document.getElementById("countBox");

  tbody.innerHTML="";
  setStatus("info","Loading bookings...");

  try{
    const res=await fetch(`${API_BASE}/api/my-bookings/${userId}`);
    const data=await res.json();

    if(!Array.isArray(data)||!data.length){
      setStatus("warning","No bookings found.");
      countBox.innerText="0 Appointments";
      return;
    }

    setStatus("success","Bookings loaded successfully.");
    countBox.innerText=`${data.length} Appointments`;

    data.forEach(b=>{
      const tr=document.createElement("tr");
      tr.innerHTML=`
        <td>${b.date||"-"}</td>
        <td>${b.time||"-"}</td>
        <td>${b.service||"-"}</td>
        <td>
          <button class="btn btn-sm btn-outline-danger" onclick="deleteBooking('${b._id}')">Delete</button>
        </td>`;
      tbody.appendChild(tr);
    });

  }catch(e){
    setStatus("danger","Error loading bookings.");
  }
}

async function deleteBooking(id){

  const ok=confirm("Delete this booking?");
  if(!ok) return;

  const userId=localStorage.getItem("userId");

  try{
    const res=await fetch(`${API_BASE}/api/booking/${id}?userId=${userId}`,{method:"DELETE"});
    const data=await res.json();
    const success=(data.message||"").includes("✅");
    setStatus(success?"success":"danger",data.message||"Failed");
  }catch(e){
    setStatus("danger","Server error.");
  }

  loadBookings();
}

/* Reveal Animation */
const reveals=document.querySelectorAll(".reveal");
const obs=new IntersectionObserver(entries=>{
  entries.forEach(e=>{
    if(e.isIntersecting) e.target.classList.add("active");
  });
},{threshold:.2});
reveals.forEach(r=>obs.observe(r));

loadBookings();
</script>

</body>
</html>
